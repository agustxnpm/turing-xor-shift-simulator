<div class="tm-simulator">
  <!-- Encabezado -->
  <header class="simulator-header">
    <h1>Simulador de Máquina de Turing</h1>
    <p class="subtitle">Visualización paso a paso del algoritmo</p>
  </header>

  <!-- Configuración de XOR-Shift -->
  <section class="config-section">
    <h2>Configuración XOR-Shift</h2>
    <div class="config-form">
      <div class="form-group">
        <label for="semilla">Semilla Inicial:</label>
        <input id="semilla" type="text" [(ngModel)]="semillaInicial" placeholder="Ej: 110010">
      </div>
      <div class="form-group">
        <label for="despA">Desplazamiento A:</label>
        <input id="despA" type="number" [(ngModel)]="desplazamientoA" min="0">
      </div>
      <div class="form-group">
        <label for="despB">Desplazamiento B:</label>
        <input id="despB" type="number" [(ngModel)]="desplazamientoB" min="0">
      </div>
      <div class="form-group">
        <label for="despC">Desplazamiento C:</label>
        <input id="despC" type="number" [(ngModel)]="desplazamientoC" min="0">
      </div>
      <button class="btn btn-primary" (click)="reinicializarMaquina()">Aplicar Configuración</button>
    </div>
  </section>

  <!-- Diagrama de Estados -->
  <app-diagrama-estados
    [funcionTransicion]="funcionTransicion"
    [estadoActual]="obtenerEstadoActual()"
    [estadoInicial]="estadoInicial"
    [estadosAceptacion]="estadosAceptacion"
    [width]="1000"
    [height]="600">
  </app-diagrama-estados>

  <!-- Panel de información -->
  <section class="info-panel">
    <div class="info-item">
      <span class="label">Estado Actual:</span>
      <span class="value state-badge" [class.accepting]="estaEnEstadoAceptacion()">
        {{ obtenerEstadoActual() }}
      </span>
    </div>
    <div class="info-item">
      <span class="label">Ciclos Ejecutados:</span>
      <span class="value">{{ ciclosEjecutados }}</span>
    </div>
    <div class="info-item">
      <span class="label">Pasos Ejecutados:</span>
      <span class="value">{{ pasosEjecutados }}</span>
    </div>
    <div class="info-item">
      <span class="label">Posición Cabezal:</span>
      <span class="value">{{ obtenerPosicionCabezal() }}</span>
    </div>
    <div class="info-item">
      <span class="label">Estado:</span>
      <span class="value status-badge" 
            [class.halted]="estaDetenida()" 
            [class.running]="!estaDetenida()">
        {{ estaDetenida() ? 'Detenida' : 'Ejecutando' }}
      </span>
    </div>
  </section>

  <!-- Visualización de la cinta -->
  <section class="tape-section">
    <h2>Cinta</h2>
    <div class="tape-container">
      <div class="tape-wrapper">
        <span *ngFor="let simbolo of obtenerCinta(); let i = index"
              class="tape-cell"
              [class.active-head]="i === obtenerPosicionCabezal()"
              [class.blank]="simbolo === '_'"
              [class.marcador]="simbolo === '@' || simbolo === '#' || simbolo === '$'">
          {{ simbolo }}
        </span>
      </div>
    </div>
    <div class="tape-legend" *ngIf="obtenerPosicionCabezal() >= 0">
      <span class="legend-item">
        <span class="legend-marker head"></span> Cabezal
      </span>
      <span class="legend-item">
        <span class="legend-marker blank"></span> Celda vacía
      </span>
      <span class="legend-item">
        <span class="legend-marker marcador"></span> Marcadores
      </span>
    </div>
  </section>

  <!-- Controles -->
  <section class="controls-section">
    <h2>Controles</h2>
    
    <!-- NUEVO: CONTROL DE VELOCIDAD -->
    <div class="speed-control-group">
      <label for="speed-slider" class="speed-label">
        Velocidad de Ejecución: {{ velocidadEjecucion }} ms/paso
      </label>
      <input 
        id="speed-slider"
        type="range" 
        min="5" 
        max="1000" 
        step="1" 
        [(ngModel)]="velocidadEjecucion" 
        [disabled]="ejecutandose"
        class="speed-slider">
      <div class="speed-indicators">
        <span class="speed-min">Rápido</span>
        <span class="speed-max">Lento</span>
      </div>
    </div>

    <div class="button-group">
      <button 
        class="btn btn-primary"
        (click)="onPaso()"
        [disabled]="estaDetenida() || ejecutandose"
        title="Ejecutar un paso">
        <span class="btn-icon">▶</span>
        Paso
      </button>

      <button 
        class="btn btn-success"
        (click)="onEjecutar()"
        [disabled]="estaDetenida()"
        title="{{ ejecutandose ? 'Detener ejecución' : 'Ejecutar continuamente' }}">
        <span class="btn-icon">{{ ejecutandose ? '⏸' : '▶▶' }}</span>
        {{ ejecutandose ? 'Pausar' : 'Ejecutar' }}
      </button>

      <button 
        class="btn btn-warning"
        (click)="onEjecutarInstantanea()"
        [disabled]="estaDetenida() || ejecutandose"
        title="Ejecutar hasta detenerse">
        <span class="btn-icon">⚡</span>
        Ejecutar Instantánea
      </button>

      <button 
        class="btn btn-secondary"
        (click)="onReiniciar()"
        title="Reiniciar la máquina">
        <span class="btn-icon">↻</span>
        Reiniciar
      </button>
    </div>

    <div class="status-message" *ngIf="estaDetenida()">
      <span class="icon">ℹ</span>
      <span *ngIf="estaEnEstadoAceptacion()">
        La máquina ha terminado en un <strong>estado de aceptación</strong>.
      </span>
      <span *ngIf="!estaEnEstadoAceptacion()">
        La máquina se ha <strong>detenido</strong>. No hay transición disponible.
      </span>
    </div>
  </section>
</div>